# Cloud for Save

-----

## 简介

**Cloud for Save** 是一个用 Go 语言构建的现代化云存储解决方案，旨在提供可靠、高效的数据存储和访问服务。它不仅支持通过配置文件进行静态配置，还提供一个直观的 Web 界面，允许用户进行动态配置、数据权限管理、数据监控回调设置以及数据预处理。此外，用户还可以方便地生成链接分享文件，并进行详细的数据访问审计。

-----

## 主要特性

  * **数据存储与访问：** 安全高效地存储和检索用户数据。
  * **灵活配置：**
      * **配置文件：** 支持 YAML/JSON 等格式的静态配置文件，用于初始化和基础设置。
      * **Web 动态配置：** 提供管理界面，允许运行时修改存储路径、上传限制等。
  * **数据权限管理：** 精细化控制用户和组对文件或目录的读写权限。
  * **数据监控回调：** 支持配置事件回调（例如：文件上传、删除、访问），用于集成外部系统或进行实时通知。
  * **数据预处理：** 支持文件上传后的自动处理流程，例如：图片缩略图生成、视频转码、文件哈希计算等。
  * **链接分享：** 生成可分享的公开或私有链接，支持设置有效期、访问密码和下载次数限制。
  * **数据访问审计：** 记录详细的数据访问日志，包括访问者、时间、操作类型等，便于追踪和安全审计。

-----

## 项目架构概览

**Cloud for Save** 将采用模块化设计，以确保高内聚、低耦合，便于扩展和维护。

```
+------------------+     +-------------------+     +------------------+
|                  |     |                   |     |                  |
| Web UI (Frontend)|<--->|  API Gateway      |<--->|  Core Services   |
|  (HTML/JS/CSS)   |     |  (Authentication, |     | (Storage, Authz, |
|                  |     |   Routing)        |     | Monitoring, etc.)|
+------------------+     +-------------------+     +------------------+
         ^                                                   |
         |                                                   |
         |                                                   v
+-----------------------+                    +-----------------------+
|                       |                    |                       |
| Configuration Service |<------------------>|     Database          |
| (File/DB backed)      |                    |(Metadata, Users, etc.)|
|                       |                    +-----------------------+
+-----------------------+
         ^
         |
         |
+-----------------------+
|                       |
|   Object Storage      |
| (Local Disk/S3/MinIO) |
|                       |
+-----------------------+
```

  * **API Gateway:** 负责所有外部请求的路由、认证和基本的请求校验。
  * **Core Services:** 包含核心业务逻辑，如：
      * **Storage Service:** 处理文件的上传、下载、删除等操作，与底层对象存储交互。
      * **Auth Service:** 用户认证与会话管理。
      * **Authz Service:** 权限管理和授权逻辑。
      * **Monitoring Service:** 处理数据监控回调和事件触发。
      * **Preprocessing Service:** 队列和执行数据预处理任务。
      * **Sharing Service:** 生成和管理分享链接。
      * **Audit Service:** 记录所有数据访问和操作日志。
  * **Configuration Service:** 统一管理所有配置，支持从文件加载和通过 Web UI 动态更新。
  * **Object Storage:** 底层存储系统，可以是本地磁盘、兼容 S3 的存储（如 MinIO）或云服务提供商的存储（如 AWS S3）。
  * **Database:** 存储用户元数据、文件元数据、权限信息、分享链接信息以及审计日志等。

-----

## 项目结构 (初步)

```
cloud-for-save/
├── cmd/
│   └── server/             # 主应用入口
│       └── main.go
├── configs/                # 配置文件目录
│   └── config.yaml.example
├── internal/
│   ├── api/                # API 接口定义和路由
│   │   ├── handler/        # HTTP 请求处理函数
│   │   ├── middleware/     # 中间件，如认证、日志
│   │   └── router.go
│   ├── auth/               # 认证与授权模块
│   │   ├── jwt.go
│   │   └── permission.go
│   ├── config/             # 配置加载与管理
│   │   ├── manager.go      # 配置管理接口
│   │   └── model.go        # 配置结构体
│   ├── db/                 # 数据库连接与模型定义
│   │   └── models/
│   │   └── migrations/
│   ├── filesystem/         # 文件系统操作接口（抽象层）
│   │   └── local.go        # 本地文件系统实现
│   │   └── s3.go           # S3 兼容存储实现 (待实现)
│   ├── core/               # 核心业务逻辑服务
│   │   ├── storage/        # 存储服务
│   │   ├── share/          # 分享服务
│   │   ├── preprocess/     # 预处理服务
│   │   ├── monitor/        # 监控回调服务
│   │   └── audit/          # 审计服务
│   ├── web/                # Web UI 相关文件 (如果集成到Go应用中)
│   │   ├── assets/
│   │   └── templates/
│   └── utils/              # 工具函数
│       └── errors.go
│       └── helpers.go
├── pkg/                    # 可复用的公共库
│   ├── logger/             # 日志工具（支持本地日志文件 cloud-for-save.log，记录服务运行、配置变更、错误等信息）
│   ├── sync/               # 并发工具
│   └── security/           # 安全相关工具
├── scripts/                # 脚本文件 (构建、部署、测试)
│   └── build.sh
│   └── deploy.sh
├── go.mod                  # Go 模块文件
├── go.sum
└── README.md               # 本文件
```

### 结构说明：

  * **`cmd/`**: 包含项目的入口点。`server/` 是主 HTTP 服务器的启动文件。
  * **`configs/`**: 存放示例配置文件，用户可以基于此进行修改。
  * **`internal/`**: 存放项目的私有代码，外部不应直接引用。
      * **`api/`**: 定义 HTTP API 接口。`handler` 处理具体请求，`middleware` 负责公共逻辑，`router` 定义路由。
      * **`auth/`**: 认证和权限管理逻辑。
      * **`config/`**: 负责加载和管理应用配置。
      * **`db/`**: 数据库相关的代码，包括 ORM 模型和数据库迁移。
      * **`filesystem/`**: 抽象文件存储层，可以轻松切换不同的底层存储实现（本地、S3等）。
      * **`core/`**: 包含各个核心业务逻辑服务的实现。
      * **`web/`**: 如果 Web UI 直接由 Go 应用提供服务（例如使用 Go 模板引擎），则前端资产和模板会放在这里。如果使用单独的前端框架（如 React/Vue），这部分可能就不需要了，Go 应用只提供 API。
      * **`utils/`**: 项目内部使用的通用工具函数。
  * **`pkg/`**: 存放可以被外部项目或模块复用的公共库。
  * **`scripts/`**: 存放构建、部署、测试等自动化脚本。
  * **`go.mod`, `go.sum`**: Go 模块管理文件。
  * **`README.md`**: 项目说明文档。

-----

## 快速开始 (开发中)

待补充... (例如：如何克隆项目、安装依赖、运行开发服务器等)

-----

## 贡献

欢迎社区成员为 **Cloud for Save** 贡献代码和建议！
